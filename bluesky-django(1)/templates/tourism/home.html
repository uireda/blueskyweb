{% extends 'tourism/base.html' %}
{% load static %}
{% load custom_filters %}

{% block content %}
<!-- Hero Section -->
<section class="hero" id="accueil">
    <div class="hero-content">
        <h1 class="fade-in">Découvrez le Monde avec Blue Sky tourism</h1>
        <p class="fade-in">Des années d'expérience pour vous offrir les voyages de vos rêves</p>
        
        <form class="search-form fade-in" method="post">
            {% csrf_token %}
            <input type="hidden" name="search_submit" value="1">
            
            <div class="form-group">
                <label for="{{ search_form.destination.id_for_label }}">Destination</label>
                {{ search_form.destination }}
            </div>
            <div class="form-group">
                <label for="{{ search_form.departure_date.id_for_label }}">Date de départ</label>
                {{ search_form.departure_date }}
            </div>
            <div class="form-group">
                <label for="{{ search_form.duration.id_for_label }}">Durée</label>
                {{ search_form.duration }}
            </div>
            <div class="form-group">
                <label for="{{ search_form.travelers_count.id_for_label }}">Voyageurs</label>
                {{ search_form.travelers_count }}
            </div>
            <div class="form-group">
                <label for="{{ search_form.email.id_for_label }}">Email (optionnel)</label>
                {{ search_form.email }}
            </div>
            <div class="form-group">
                <label for="{{ search_form.phone.id_for_label }}">Téléphone (optionnel)</label>
                {{ search_form.phone }}
            </div>
            <button type="submit" class="search-btn">
                <i class="fas fa-search"></i> Rechercher
            </button>
        </form>
    </div>
</section>

<!-- Offres Vedettes -->
{% if featured_travel_offers %}
<section class="section" style="background: linear-gradient(135deg, #ff6b35, #f7931e); color: white;">
    <div class="container">
        <h2 class="section-title" style="color: white;">Offres Exceptionnelles</h2>
        <p style="text-align: center; font-size: 1.2rem; margin-bottom: 3rem; opacity: 0.9;">
            Dates et prix fixes - Places limitées
        </p>
        
        <div class="destinations-grid">
            {% for offer in featured_travel_offers %}
            <div class="destination-card" onclick="window.location.href='{% url 'tourism:offer_detail' offer.pk %}'" style="transform: translateY(0); box-shadow: 0 15px 35px rgba(0,0,0,0.2);">
                <div class="destination-image" style="position: relative;">
                    {% if offer.image %}
                        <img src="{{ offer.image.url }}" alt="{{ offer.title }}">
                    {% elif offer.destination.image %}
                        <img src="{{ offer.destination.image.url }}" alt="{{ offer.title }}">
                    {% else %}
                        <i class="{{ offer.destination.icon_class }}"></i>
                    {% endif %}
                    
                    <div style="position: absolute; top: 10px; left: 10px; background: rgba(255,255,255,0.9); color: #ff6b35; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
                        {{ offer.get_offer_type_display }}
                    </div>
                    
                    {% if offer.available_spots <= 5 %}
                    <div style="position: absolute; top: 10px; right: 10px; background: #dc3545; color: white; padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold;">
                        {{ offer.available_spots }} places
                    </div>
                    {% endif %}
                </div>
                <div class="destination-info">
                    <h3>{{ offer.title }}</h3>
                    <p><i class="fas fa-map-marker-alt"></i> {{ offer.destination.name }}</p>
                    <p><i class="fas fa-calendar"></i> {{ offer.departure_date }} - {{ offer.return_date }}</p>
                    <p><i class="fas fa-clock"></i> {{ offer.duration_days }}J/{{ offer.duration_nights }}N</p>
                    
                    <div class="price">
                        {% if offer.original_price > offer.offer_price %}
                            <span class="old-price">{{ offer.original_price }}€</span>
                            <span style="background: #dc3545; color: white; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-left: 0.5rem;">-{{ offer.discount_percentage }}%</span>
                        {% endif %}
                        <div style="font-size: 1.5rem; font-weight: bold; color: #ff6b35; margin-top: 0.5rem;">
                            {{ offer.offer_price }}€*
                        </div>
                        <div style="font-size: 0.8rem; color: #666;">
                            Acompte dès {{ offer|get_deposit_amount_filter:offer.offer_price }}€
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <div style="text-align: center; margin-top: 2rem;">
            <a href="{% url 'tourism:offers_list' %}" class="btn-primary" style="background: white; color: #ff6b35; text-decoration: none;">
                Voir toutes nos offres
            </a>
        </div>
    </div>
</section>
{% endif %}

<!-- Destinations Section -->
<section class="section" id="destinations">
    <div class="container">
        <h2 class="section-title">Nos Séjours</h2>
        <div class="destinations-grid">
            {% for destination in destinations %}
            <div class="destination-card" onclick="window.location.href='{% url 'tourism:destination_detail' destination.pk %}'">
                <div class="destination-image">
                    {% if destination.image %}
                        <img src="{{ destination.image.url }}" alt="{{ destination.name }}">
                    {% else %}
                        <i class="{{ destination.icon_class }}"></i>
                    {% endif %}
                </div>
                <div class="destination-info">
                    <h3>{{ destination.name }}</h3>
                    <p>Hôtels {{ destination.hotel_rating_display }} - {{ destination.duration_days }}J/{{ destination.duration_nights }}N - {{ destination.package_type }}</p>
                    <p>Au départ de {{ destination.departure_city }}</p>
                    {% if destination.hotels.count > 1 %}
                        <p><small><i class="fas fa-hotel"></i> {{ destination.hotels.count }} hôtels disponibles</small></p>
                    {% endif %}
                    <div class="price">
                        {% if destination.original_price > destination.current_price %}
                            <span class="old-price">{{ destination.original_price }}€</span>
                        {% endif %}
                        {{ destination.current_price }}€*
                    </div>
                </div>
            </div>
            {% empty %}
            <p>Aucune destination disponible pour le moment.</p>
            {% endfor %}
        </div>
        <div style="text-align: center; margin-top: 2rem;">
            <a href="{% url 'tourism:destinations' %}" class="btn btn-primary">Voir toutes les destinations</a>
        </div>
    </div>
</section>

<!-- Clubs Section -->
<section class="section clubs-section" id="clubs">
    <div class="container">
        <h2 class="section-title">L'Expérience Blue Sky Tourism</h2>
        <p style="text-align: center; font-size: 1.2rem; margin-bottom: 2rem; color: #666;">
            Profitez du meilleur de notre agence : Vols, Hotels, Séjours, Voyages organisés
        </p>
        
        <div class="clubs-grid">
            {% for service in club_services %}
            <div class="club-card">
                <div class="club-icon">
                    <i class="{{ service.icon_class }}"></i>
                </div>
                <h3>{{ service.title }}</h3>
                <p>{{ service.description }}</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Special Offers -->
<section class="section offers-section">
    <div class="container">
        <h2 class="section-title" style="color: white;">Offres Spéciales</h2>
        
        <div class="offers-grid">
            {% for offer in special_offers %}
            <div class="offer-card">
                <div class="offer-badge">{{ offer.badge_text }}</div>
                <h3>{{ offer.title }}</h3>
                <p>{{ offer.description }}</p>
                {% if offer.conditions %}
                    <p><strong>{{ offer.conditions }}</strong></p>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Testimonials -->
<section class="section">
    <div class="container">
        <h2 class="section-title">Ce que disent nos clients</h2>
        
        <div class="testimonials-grid">
            {% for testimonial in testimonials %}
            <div class="testimonial">
                <div class="testimonial-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="stars">
                    {% for star in testimonial.stars_range %}
                        <i class="fas fa-star"></i>
                    {% endfor %}
                </div>
                <p>"{{ testimonial.comment }}"</p>
                <strong>{{ testimonial.client_name }} - {{ testimonial.client_city }}</strong>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Contact Form Section -->
<section class="section" style="background: #f8f9fa;">
    <div class="container">
        <h2 class="section-title">Contactez-nous</h2>
        <div style="max-width: 600px; margin: 0 auto;">
            <form method="post" class="contact-form">
                {% csrf_token %}
                <input type="hidden" name="contact_submit" value="1">
                
                <div class="form-group">
                    <label for="{{ contact_form.name.id_for_label }}">Nom complet</label>
                    {{ contact_form.name }}
                </div>
                
                <div class="form-group">
                    <label for="{{ contact_form.email.id_for_label }}">Email</label>
                    {{ contact_form.email }}
                </div>
                 
                <div class="form-group">
                    <label for="{{ contact_form.phone.id_for_label }}">Téléphone</label>
                    {{ contact_form.phone }}
                </div>
                
                <div class="form-group">
                    <label for="{{ contact_form.subject.id_for_label }}">Sujet</label>
                    {{ contact_form.subject }}
                </div>
                
                <div class="form-group">
                    <label for="{{ contact_form.message.id_for_label }}">Message</label>
                    {{ contact_form.message }}
                </div>
                
                <button type="submit" class="search-btn">
                    <i class="fas fa-paper-plane"></i> Envoyer le message
                </button>
            </form>
        </div>
    </div>
</section>
{% endblock %}
